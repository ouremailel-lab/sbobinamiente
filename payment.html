<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Pagamento - SbobinaMente</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS (opzionale) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2>Pagamento</h2>
        <div id="cartSummary" class="mb-4">
            <!-- Riepilogo carrello -->
        </div>
        <div id="checkoutContainer">
            <!-- Form pagamento Stripe -->
        </div>
        <button id="startPayment" class="btn btn-primary btn-block mt-3">Procedi al pagamento</button>
    </div>

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- Script pagamento -->
    <script src="stripe-payment.js"></script>
    <script>
        // Mostra il riepilogo del carrello
        function renderCartSummary() {
            if (!window.cart || cart.length === 0) {
                document.getElementById('cartSummary').innerHTML = '<div class="alert alert-warning">Il carrello è vuoto.</div>';
                document.getElementById('startPayment').disabled = true;
                return;
            }
            let html = '<ul class="list-group">';
            let total = 0;
            cart.forEach(item => {
                html += `<li class="list-group-item d-flex justify-content-between align-items-center">
                    ${item.nome} <span>${item.prezzo.toFixed(2)}€ x ${item.quantity}</span>
                </li>`;
                total += item.prezzo * item.quantity;
            });
            html += `</ul><div class="mt-3"><strong>Totale: ${total.toFixed(2)}€</strong></div>`;
            document.getElementById('cartSummary').innerHTML = html;
        }

        // Carica il carrello e aggiorna la pagina
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof loadCart === 'function') loadCart();
            renderCartSummary();
        });

        // Avvia il checkout Stripe
        document.getElementById('startPayment').onclick = function() {
            showStripeCheckout();
        };
    </script>
</body>
</html>
<script async
  src="https://js.stripe.com/v3/buy-button.js">
</script>

<stripe-buy-button
  buy-button-id="buy_btn_1Sj871Rt036j0vpeMoHKiOYc"
  publishable-key="pk_live_51Sj7KCRt036j0vpehTeZIDMPqpBV1K84i9pKrRGMYD96q8le2oUxdyCHsPFIomWjEmC1x8xZ75mptnU1wxhsZWMM006WXP87Rl"
>
</stripe-buy-button>
