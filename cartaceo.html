<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acquista Cartaceo - SbobinaMente</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header e Navigazione -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1><a href="index.html" style="text-decoration: none; color: inherit;">SbobinaMente</a></h1>
                    <p class="tagline">Appunti e PDF Protetti</p>
                </div>
                <nav class="nav">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="lezioni.html" class="nav-link">Lezioni</a>
                    <a href="chi-siamo.html" class="nav-link">Chi Siamo</a>
                    <a href="#" class="nav-link" id="cartLink">Carrello <span class="cart-count">0</span></a>
                    <a href="#" class="nav-link" id="userLink">Accedi</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Hero Section Cartaceo -->
    <section class="hero cartaceo-hero">
        <div class="container">
            <div class="hero-content">
                <img src="image/copia_cartacea.png" alt="Copia Cartacea SbobinaMente" style="max-width: 600px; width: 100%; height: auto; margin: 0 auto 30px; display: block; border-radius: 12px; box-shadow: 0 6px 12px rgba(0,0,0,0.15);">
                <h2>üìï Acquista Cartaceo</h2>
                <p>Appunti stampati e rilegati professionalmente, spediti a casa tua</p>
            </div>
        </div>
    </section>

    <!-- Info Spedizione -->
    <section class="info-section">
        <div class="container">
            <div class="info-cards">
                <div class="info-card">
                    <span class="info-icon">üì¶</span>
                    <h3>Spedizione Rapida</h3>
                    <p>Consegna in 3-5 giorni lavorativi in tutta Italia</p>
                </div>
                <div class="info-card">
                    <span class="info-icon">üé®</span>
                    <h3>Rilega Premium</h3>
                    <p>Rilegati professionalmente con spirale o brossura</p>
                </div>
                <div class="info-card">
                    <span class="info-icon">‚úÖ</span>
                    <h3>Qualit√† Garantita</h3>
                    <p>Carta di qualit√† e stampa nitida a colori</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Sezione Prodotti Cartacei -->
    <section class="products-section">
        <div class="container">
            <h2>I Nostri Prodotti Stampati</h2>
            
            <!-- Filtri Cartaceo -->
            <div class="filters">
                <div class="filter-group">
                    <label>Materia:</label>
                    <select id="filterMateria" onchange="applyFilters()">
                        <option value="">Tutte</option>
                        <option value="diritto">Diritto</option>
                        <option value="matematica">Matematica</option>
                        <option value="storia">Storia</option>
                        <option value="lingue">Lingue</option>
                        <option value="scienze">Scienze</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Prezzo max:</label>
                    <input type="range" id="filterPrezzo" min="0" max="50" value="50" onchange="applyFilters()">
                    <span id="prezzoDisplay">50‚Ç¨</span>
                </div>
            </div>

            <!-- Griglia Prodotti Cartacei -->
            <div class="products-grid" id="productsGrid">
                <!-- I prodotti verranno inseriti via JavaScript -->
            </div>
        </div>
    </section>

    <!-- Modal Carrello -->
    <div id="cartModal" class="modal">
        <div class="modal-content modal-lg">
            <span class="close" onclick="closeCart()">&times;</span>
            <h2>Carrello</h2>
            <div class="cart-discount-summary"></div>
            <div class="cart-items" id="cartItems">
                <p class="empty-message">Il carrello √® vuoto</p>
            </div>
            <div class="cart-summary">
                <div class="summary-row">
                    <span>Totale:</span>
                    <span class="total-price">0‚Ç¨</span>
                </div>
                <button class="btn btn-primary" onclick="proceedToCheckout()">Procedi al Pagamento</button>
            </div>
        </div>
    </div>

    <!-- Modal Prodotto -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProductModal()">&times;</span>
            <div class="product-detail" id="productDetail">
                <!-- Dettagli prodotto via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal Anteprima Pagine -->
    <div id="previewModal" class="modal">
        <div class="modal-content modal-lg">
            <span class="close" onclick="closePreviewModal()">&times;</span>
            <h2 style="color: #4a90e2; margin-bottom: 20px;">üëÅÔ∏è Anteprima Appunti</h2>
            <p style="color: #666; margin-bottom: 20px;">Sfoglia le prime pagine degli appunti</p>
            <div id="previewContent" style="display: flex; flex-direction: column; gap: 20px; max-height: 70vh; overflow-y: auto;">
                <!-- Immagini anteprima via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal Login/Registrazione -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuth()">&times;</span>
            <div class="auth-container" id="authContainer">
                <!-- Form di login/registrazione via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal Checkout -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content modal-lg">
            <span class="close" onclick="closeCheckout()">&times;</span>
            <h2>Checkout - Dati di Spedizione</h2>
            <p style="color: #666; margin-bottom: 20px;">üì¶ Compila tutti i campi per ricevere i tuoi appunti cartacei</p>
            <form id="checkoutForm" onsubmit="submitCheckout(event)">
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Nome: <span style="color: red;">*</span></label>
                        <input type="text" name="nome" placeholder="Es: Mario" required>
                    </div>
                    <div class="form-group">
                        <label>Cognome: <span style="color: red;">*</span></label>
                        <input type="text" name="cognome" placeholder="Es: Rossi" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email: <span style="color: red;">*</span></label>
                    <input type="email" name="email" placeholder="mario.rossi@example.com" required>
                </div>
                <div class="form-group">
                    <label>Indirizzo e Numero Civico: <span style="color: red;">*</span></label>
                    <input type="text" name="indirizzo" placeholder="Es: Via Roma, 123" required>
                    <small style="color: #888; font-size: 12px;">Inserisci via/piazza e numero civico completo</small>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Citt√†: <span style="color: red;">*</span></label>
                        <input type="text" name="citta" placeholder="Es: Milano" required>
                    </div>
                    <div class="form-group">
                        <label>CAP: <span style="color: red;">*</span></label>
                        <input type="text" name="cap" placeholder="20100" pattern="[0-9]{5}" maxlength="5" required>
                        <small style="color: #888; font-size: 12px;">5 cifre</small>
                    </div>
                </div>
                <div class="form-group">
                    <label>Telefono (opzionale):</label>
                    <input type="tel" name="telefono" placeholder="+39 333 1234567">
                    <small style="color: #888; font-size: 12px;">Utile per il corriere</small>
                </div>
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Totale:</span>
                        <span class="checkout-total">0‚Ç¨</span>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" onclick="payWithPayPal()">Paga con PayPal</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 SbobinaMente. Tutti i diritti riservati.</p>
            <p>Per domande: <a href="mailto:info@sbobinamante.com">info@sbobinamante.com</a></p>
        </div>
    </footer>

    <!-- EmailJS Library -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        emailjs.init('Bo-Kyor5W-Q_BRDf3');
    </script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="whatsapp-notifications.js"></script>

    <script src="products-data.js"></script>
    <script src="email-service.js"></script>
    
    <!-- Funzione globale per salvare ordini (NETLIFY FUNCTION) -->
    <script src="api-client.js"></script>
    <script>
        async function saveOrderToSupabase(order) {
            try {
                const orderData = {
                    order_id: 'ORD-' + order.id,
                    user_name: order.user?.nome || order.deliveryInfo?.nome || 'Cliente',
                    user_email: order.user?.email || order.deliveryInfo?.email || '',
                    items: order.items,
                    total: order.total,
                    delivery_info: order.deliveryInfo,
                    order_date: order.orderDate,
                    status: order.status
                };
                
                // ‚úÖ USA NETLIFY FUNCTION (SICURO)
                if (window.API && window.API.createOrder) {
                    const result = await window.API.createOrder(orderData);
                    console.log('‚úÖ Ordine salvato via API:', result.order);
                } else {
                    throw new Error('API non disponibile');
                }
                
                // Invia notifica WhatsApp
                if (window.whatsappNotify) {
                    await window.whatsappNotify.order(orderData);
                }
            } catch (error) {
                console.error('‚ùå Errore salvataggio ordine:', error);
                // Fallback: localStorage
                try {
                    let orders = JSON.parse(localStorage.getItem('orders')) || [];
                    orders.push({
                        order_id: 'ORD-' + order.id,
                        user_email: order.user?.email || order.deliveryInfo?.email || '',
                        items: order.items,
                        total: order.total
                    });
                    localStorage.setItem('orders', JSON.stringify(orders));
                    console.log('‚ö†Ô∏è Ordine salvato su localStorage (fallback)');
                } catch (e) {
                    console.error('Errore fallback:', e);
                }
            }
        }
        window.saveOrderToSupabase = saveOrderToSupabase;
    </script>
    
    <script src="app-cartaceo.js"></script>
    <script src="paypal-handler.js"></script>
    <script src="pdf-protection.js"></script>
</body>
</html>
